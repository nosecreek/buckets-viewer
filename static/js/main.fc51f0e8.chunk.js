(this["webpackJsonpbuckets-viewer"]=this["webpackJsonpbuckets-viewer"]||[]).push([[0],{177:function(e,t,n){var c=this&&this.__assign||function(){return c=Object.assign||function(e){for(var t,n=1,c=arguments.length;n<c;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},c.apply(this,arguments)},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(182),i=r(n(183));t.default=function(){var e,t=["https://www.googleapis.com/auth/drive.readonly"],n=(0,i.default)("https://apis.google.com/js/api.js"),r=n[0],s=n[1],l=(0,i.default)("https://accounts.google.com/gsi/client"),u=l[0],d=l[1],j=(0,o.useState)(!1),b=j[0],p=j[1],f=(0,o.useState)(!1),O=f[0],h=f[1],v=(0,o.useState)(a.defaultConfiguration),g=v[0],x=v[1],m=(0,o.useState)(),w=m[0],k=m[1],S=window.google;(0,o.useEffect)((function(){!r||s||!u||d||b||y()}),[r,s,u,d,b]),(0,o.useEffect)((function(){O&&g.token&&r&&!s&&u&&!d&&b&&(M(g),h(!1))}),[O,g.token,r,s,u,d,b]);var y=function(){window.gapi.load("auth"),window.gapi.load("picker",{callback:I})},I=function(){p(!0)},M=function(t){var n=t.token,c=t.supportDrives,r=void 0!==c&&c,o=t.developerKey,a=t.viewId,i=void 0===a?"DOCS":a,s=t.disabled,l=t.multiselect,u=t.showUploadView,d=void 0!==u&&u,j=t.showUploadFolders,b=t.setParentFolder,p=void 0===b?"":b,f=t.viewMimeTypes,O=t.viewQuery,h=t.customViews,v=t.locale,g=void 0===v?"en":v,x=t.setIncludeFolders,m=t.setSelectFolderEnabled,w=t.disableDefaultView,k=void 0!==w&&w,y=t.callbackFunction;if(s)return!1;var I=new S.picker.DocsView(S.picker.ViewId[i]);f&&I.setMimeTypes(f),x&&I.setSelectFolderEnabled(!0),m&&I.setSelectFolderEnabled(!0),O&&I.setQuery(O);var M=new S.picker.DocsUploadView;return f&&M.setMimeTypes(f),j&&M.setIncludeFolders(!0),p&&M.setParent(p),e=(new S.picker.PickerBuilder).setAppId("758483264841").setOAuthToken(n).setDeveloperKey(o).setLocale(g).setCallback(y),k||e.addView(I),h&&h.map((function(t){return e.addView(t)})),l&&e.enableFeature(S.picker.Feature.MULTISELECT_ENABLED),d&&e.addView(M),r&&e.enableFeature(S.picker.Feature.SUPPORT_DRIVES),e.build().setVisible(!0),!0};return[function(e){(x(e),e.token)||S.accounts.oauth2.initTokenClient({client_id:e.clientId,scope:(e.customScopes?e.customScopes:t).join(" "),callback:function(t){k(t),M(c(c({},e),{token:t.access_token}))}}).requestAccessToken();if(e.token&&r&&!s&&b)return M(e)},w]}},182:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultConfiguration=void 0,t.defaultConfiguration={clientId:"",developerKey:"",viewId:"DOCS",callbackFunction:function(){return null}}},183:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var c=n(0),r={queue:{},injectorMap:{},scriptMap:{}};t.default=function(e){var t=(0,c.useState)({loaded:!1,error:!1}),n=t[0],o=t[1];return(0,c.useEffect)((function(){var t,n,c,a,i;if((null===(t=r.injectorMap)||void 0===t?void 0:t[e])||(r.injectorMap[e]="init"),"loaded"!==r.injectorMap[e]){if("error"!==r.injectorMap[e]){var s=function(t){var n,c,o,a;t&&console.log("error loading the script"),null===(c=null===(n=r.queue)||void 0===n?void 0:n[e])||void 0===c||c.forEach((function(e){return e(t)})),t&&r.scriptMap[e]?(null===(a=null===(o=r.scriptMap)||void 0===o?void 0:o[e])||void 0===a||a.remove(),r.injectorMap[e]="error"):r.injectorMap[e]="loaded",delete r.scriptMap[e]},l=function(e){o({loaded:!0,error:e})};return(null===(n=r.scriptMap)||void 0===n?void 0:n[e])||(r.scriptMap[e]=document.createElement("script"),r.scriptMap[e]&&(r.scriptMap[e].src=e,r.scriptMap[e].async=!0,document.body.append(r.scriptMap[e]),r.scriptMap[e].addEventListener("load",(function(){return s(!1)})),r.scriptMap[e].addEventListener("error",(function(){return s(!0)})),r.injectorMap[e]="loading")),(null===(c=r.queue)||void 0===c?void 0:c[e])?null===(i=null===(a=r.queue)||void 0===a?void 0:a[e])||void 0===i||i.push(l):r.queue[e]=[l],function(){var t,n;r.scriptMap[e]&&(null===(t=r.scriptMap[e])||void 0===t||t.removeEventListener("load",(function(){return s(!0)})),null===(n=r.scriptMap[e])||void 0===n||n.removeEventListener("error",(function(){return s(!0)})))}}o({loaded:!0,error:!0})}else o({loaded:!0,error:!1})}),[e]),[n.loaded,n.error]}},208:function(e,t){},210:function(e,t){},221:function(e,t){},223:function(e,t){},249:function(e,t){},251:function(e,t){},252:function(e,t){},257:function(e,t){},259:function(e,t){},265:function(e,t){},267:function(e,t){},286:function(e,t){},298:function(e,t){},301:function(e,t){},310:function(e,t,n){},313:function(e,t,n){"use strict";n.r(t);var c=n(0),r=n(51),o=n(39),a=n(85),i=n(7),s=n(177),l=n.n(s),u=n(111),d=n.n(u),j=n(178),b=n.n(j),p=n(326),f=n(316),O=n(1),h=function(e){var t=e.accounts,n=e.setTransactionView,c=e.currency,r=t.filter((function(e){return"offbudget"!==e[3]})),o=t.filter((function(e){return"offbudget"===e[3]}));return Object(O.jsxs)(p.a,{defaultActiveKey:[0],alwaysOpen:!0,children:[Object(O.jsxs)(p.a.Item,{eventKey:0,children:[Object(O.jsx)(p.a.Header,{children:"Budget Accounts"}),Object(O.jsx)(p.a.Body,{children:Object(O.jsx)(f.a,{striped:!0,hover:!0,bordered:!0,children:Object(O.jsxs)("tbody",{children:[Object(O.jsxs)("tr",{children:[Object(O.jsx)("th",{children:"Name"}),Object(O.jsx)("th",{children:"Balance"})]}),r.map((function(e){return Object(O.jsxs)("tr",{onClick:function(){n(["account",e[0],e[1],e[2]])},children:[Object(O.jsx)("td",{children:e[1]}),Object(O.jsx)("td",{children:c.format(e[2]/100)})]},e[0])}))]})})})]}),Object(O.jsxs)(p.a.Item,{eventKey:1,children:[Object(O.jsx)(p.a.Header,{children:"Off Budget Accounts"}),Object(O.jsx)(p.a.Body,{children:Object(O.jsx)(f.a,{striped:!0,hover:!0,bordered:!0,children:Object(O.jsxs)("tbody",{children:[Object(O.jsxs)("tr",{children:[Object(O.jsx)("th",{children:"Name"}),Object(O.jsx)("th",{children:"Balance"})]}),o.map((function(e){return Object(O.jsxs)("tr",{onClick:function(){n(["account",e[0],e[1],e[2]])},children:[Object(O.jsx)("td",{children:e[1]}),Object(O.jsx)("td",{children:c.format(e[2]/100)})]},e[0])}))]})})})]})]})},v=function(e){var t=e.buckets,n=e.bucketCats,c=e.setTransactionView,r=e.currency;return Object(O.jsx)(p.a,{defaultActiveKey:[],alwaysOpen:!0,children:Array.from(t.entries()).map((function(e,t){return Object(O.jsxs)(p.a.Item,{eventKey:t,children:[Object(O.jsx)(p.a.Header,{children:n.values.find((function(t){return t[0]===e[0]}))?n.values.find((function(t){return t[0]===e[0]}))[1]:"Misc"}),Object(O.jsx)(p.a.Body,{children:Object(O.jsx)(f.a,{striped:!0,hover:!0,bordered:!0,children:Object(O.jsxs)("tbody",{children:[Object(O.jsxs)("tr",{children:[Object(O.jsx)("th",{children:"Name"}),Object(O.jsx)("th",{children:"Balance"})]}),e[1].map((function(e){return Object(O.jsxs)("tr",{children:[Object(O.jsx)("td",{onClick:function(){c(["bucket",e[0],e[1],e[2]])},children:e[1]}),Object(O.jsx)("td",{children:r.format(e[2]/100)})]},e[0])}))]})})})]},t)}))})},g=n(318),x=n(317),m=function(e){var t=e.setAccessToken,n=e.provider,c=e.setLoadDropbox,r=function(){var e;"Dropbox"===n?c(!0):(e="https://accounts.google.com/gsi/client",new Promise((function(t,n){if(document.querySelector('script[src="'.concat(e,'"]')))return t();var c=document.createElement("script");c.src=e,c.onload=function(){return t()},c.onerror=function(e){return n(e)},document.body.appendChild(c)}))).then((function(){window.google.accounts.oauth2.initTokenClient({client_id:"758483264841-9kmp9h0v8qghfn8e7d4k5mjg99d0fpn8.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/drive.file",callback:function(e){t(e.access_token)}}).requestAccessToken()}))};return Object(O.jsxs)(x.a,{variant:"light",onClick:function(){return r()},children:[Object(O.jsx)(g.a,{})," Reload"]})},w=function(e){var t=e.transactionView,n=e.setTransactionView,c=e.transactions,r=e.currency,o=e.dateFormat;if(!c)return Object(O.jsx)("p",{children:"No transactions found. You probably need to reload your budget file to see transactions."});var a=c.filter((function(e){return e[1]===t[1]})).reverse();return Object(O.jsxs)("div",{children:[Object(O.jsx)("h3",{children:t[2]}),Object(O.jsxs)("p",{children:[Object(O.jsxs)("strong",{children:["Balance: ",r.format(t[3]/100)]})," ","|"," ",Object(O.jsx)("button",{className:"back",onClick:function(){n(null)},children:"Go Back"})]}),Object(O.jsx)(f.a,{striped:!0,hover:!0,bordered:!0,children:Object(O.jsxs)("tbody",{children:[Object(O.jsxs)("tr",{children:[Object(O.jsx)("th",{children:"Posted"}),Object(O.jsx)("th",{children:"Memo"}),Object(O.jsx)("th",{children:"Amount"})]}),a.map((function(e){return Object(O.jsxs)("tr",{children:[Object(O.jsx)("td",{children:new Date(e[2].split(" ")[0]).toLocaleDateString(void 0,o)}),Object(O.jsx)("td",{children:e[3]}),Object(O.jsx)("td",{children:r.format(e[4]/100)})]},e[0])}))]})})]})},k=n(320),S=n(324),y=n(321),I=n(325),M=n(327),E=n(322),T=n(323),C=(n(310),n(319)),F=function(e){var t=e.openPicker,n=e.setFileSize,c=e.setFileId,r=e.setProvider;return Object(O.jsxs)(x.a,{size:"lg",variant:"danger",className:"googleButton",onClick:function(){t({clientId:"758483264841-9kmp9h0v8qghfn8e7d4k5mjg99d0fpn8.apps.googleusercontent.com",developerKey:"AIzaSyAmKw4RxJhq67-H-M2HkjoqibzJN5fzqds",viewId:"DOCS",showUploadView:!1,showUploadFolders:!1,supportDrives:!0,multiselect:!0,viewMimeTypes:"application/octet-stream",viewQuery:"*.buckets",customScopes:["https://www.googleapis.com/auth/drive.file"],callbackFunction:function(e){"cancel"===e.action&&console.log("User clicked cancel/close button"),"picked"===e.action&&(n(e.docs[0].sizeBytes),c(e.docs[0].id),localStorage.setItem("fileId",e.docs[0].id),localStorage.setItem("provider","Google"),r("Google"))}})},children:[Object(O.jsx)(C.a,{})," Google Drive"]})},D=n(3),N=["color","size","title"],A=function(e){var t=e.setFileSize,n=e.setFileId,c=e.setProvider,r=e.setLoadDropbox,o=function(e,t){e.color,e.size;var n=e.title;Object(D.a)(e,N);return Object(O.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:"1em",height:"1em",fill:"#fff",children:[n?Object(O.jsx)("title",{children:n}):null,Object(O.jsx)("path",{d:"M8.01 4.555 4.005 7.11 8.01 9.665 4.005 12.22 0 9.651l4.005-2.555L0 4.555 4.005 2 8.01 4.555Zm-4.026 8.487 4.006-2.555 4.005 2.555-4.005 2.555-4.006-2.555Zm4.026-3.39 4.005-2.556L8.01 4.555 11.995 2 16 4.555 11.995 7.11 16 9.665l-4.005 2.555L8.01 9.651Z"})]})},a=function(){var e;(e="https://www.dropbox.com/static/api/2/dropins.js",new Promise((function(t,n){if(document.querySelector('script[src="'.concat(e,'"]')))return t();var c=document.createElement("script");c.setAttribute("src",e),c.setAttribute("id","dropboxjs"),c.setAttribute("data-app-key",'"w6v9a2zx8xacepq"'),c.onload=function(){return t()},c.onerror=function(e){return n(e)},document.body.appendChild(c)}))).then((function(){window.Dropbox.choose({extensions:[".buckets"],linkType:"direct",success:function(e){e&&(t(e[0].bytes),n(e[0].link),localStorage.setItem("fileId",e[0].link),c("Dropbox"),localStorage.setItem("provider","Dropbox"),r(!0))}})}))};return Object(O.jsxs)(x.a,{size:"lg",variant:"primary",className:"dropboxButton",onClick:function(){return a()},children:[Object(O.jsx)(o,{})," Dropbox"]})};var L=function(){var e=Object(c.useState)(null),t=Object(i.a)(e,2),n=t[0],s=t[1],u=l()(),j=Object(i.a)(u,2),p=j[0],f=j[1],g=Object(c.useState)(null),C=Object(i.a)(g,2),D=C[0],N=C[1],L=Object(c.useState)(null),_=Object(i.a)(L,2),P=_[0],V=_[1],B=Object(c.useState)(null),q=Object(i.a)(B,2),J=q[0],R=q[1],U=Object(c.useState)(null),z=Object(i.a)(U,2),K=z[0],H=z[1],G=Object(c.useState)(null),W=Object(i.a)(G,2),Q=W[0],Z=W[1],Y=Object(c.useState)(null),X=Object(i.a)(Y,2),$=X[0],ee=X[1],te=Object(c.useState)(null),ne=Object(i.a)(te,2),ce=ne[0],re=ne[1],oe=Object(c.useState)("buckets"),ae=Object(i.a)(oe,2),ie=ae[0],se=ae[1],le=Object(c.useState)(null),ue=Object(i.a)(le,2),de=ue[0],je=ue[1],be=Object(c.useState)(null),pe=Object(i.a)(be,2),fe=pe[0],Oe=pe[1],he=Object(c.useState)(null),ve=Object(i.a)(he,2),ge=ve[0],xe=ve[1],me=Object(c.useState)(0),we=Object(i.a)(me,2),ke=we[0],Se=we[1],ye=Object(c.useState)(null),Ie=Object(i.a)(ye,2),Me=Ie[0],Ee=Ie[1],Te=Object(c.useState)(null),Ce=Object(i.a)(Te,2),Fe=Ce[0],De=Ce[1],Ne=Object(c.useState)(!1),Ae=Object(i.a)(Ne,2),Le=Ae[0],_e=Ae[1],Pe=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),Ve={year:"numeric",month:"long",day:"numeric"};return Object(c.useEffect)((function(){var e=function(){var e=Object(a.a)(Object(o.a)().mark((function e(t){var n,c;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Uint8Array(t.data),e.next=3,b()({locateFile:function(e){return"https://sql.js.org/dist/".concat(e)}});case 3:c=e.sent,s(new c.Database(n));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t=function(){var t=Object(a.a)(Object(o.a)().mark((function t(){var n,c,r;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Ee(null),n=f?f.access_token:ge,c={headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/x-sqlite3"},responseType:"arraybuffer",onDownloadProgress:function(e){Se(Math.floor(e.loaded/P*100))}},t.next=5,d.a.get("https://www.googleapis.com/drive/v3/files/".concat(D,"?alt=media&supportsAllDrives=true"),c).catch((function(e){Ee(e.message),N(null),R(null),De(null),localStorage.clear()}));case 5:return r=t.sent,localStorage.setItem("fileId",D),t.next=9,e(r);case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),n=function(){var t=Object(a.a)(Object(o.a)().mark((function t(){var n,c;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Ee(null),n={headers:{"Content-Type":"application/x-sqlite3"},responseType:"arraybuffer",onDownloadProgress:function(e){Se(Math.floor(e.loaded/P*100))}},t.next=4,d.a.get("".concat(D),n).catch((function(e){Ee(e.message),N(null),R(null),De(null),_e(!1),localStorage.clear()}));case 4:return c=t.sent,_e(!1),t.next=8,e(c);case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();"Google"===Fe&&(f||ge)&&D?t():"Dropbox"===Fe&&Le&&D&&(console.log("loading dropbox file"),n())}),[f,ge,D,P,Le,Fe]),Object(c.useEffect)((function(){if(n)try{var e=n.exec("SELECT id, name, balance, group_id FROM bucket WHERE kicked = 0")[0].values.reduce((function(e,t){return e.set(t[3],[].concat(Object(r.a)(e.get(t[3])||[]),[t]))}),new Map);R(e),localStorage.setItem("buckets",JSON.stringify(Array.from(e)));var t=n.exec("SELECT id, name FROM bucket_group")[0];H(t),localStorage.setItem("bucketCats",JSON.stringify(t));var c=n.exec("SELECT id, name, balance, kind FROM account WHERE closed = 0")[0].values;Z(c),localStorage.setItem("accounts",JSON.stringify(c));var o=n.exec('SELECT id, bucket_id, posted, memo, amount FROM bucket_transaction WHERE posted > date("now","-1 years")')[0].values;ee(o),localStorage.setItem("bucketTransactions",JSON.stringify(o));var a=n.exec('SELECT id, account_id, posted, memo, amount FROM account_transaction WHERE posted > date("now","-1 years")')[0].values;re(a),localStorage.setItem("accountTransactions",JSON.stringify(a)),Oe(new Date),localStorage.setItem("lastUpdated",JSON.stringify(new Date))}catch(i){Ee(i.toString()),N(null),R(null),s(null),localStorage.clear()}}),[n]),Object(c.useEffect)((function(){localStorage.getItem("buckets")&&R(new Map(JSON.parse(localStorage.getItem("buckets")))),localStorage.getItem("bucketCats")&&H(JSON.parse(localStorage.getItem("bucketCats"))),localStorage.getItem("accounts")&&Z(JSON.parse(localStorage.getItem("accounts"))),localStorage.getItem("bucketTransactions")&&ee(JSON.parse(localStorage.getItem("bucketTransactions"))),localStorage.getItem("accountTransactions")&&re(JSON.parse(localStorage.getItem("accountTransactions"))),localStorage.getItem("lastUpdated")&&Oe(new Date(JSON.parse(localStorage.getItem("lastUpdated")))),localStorage.getItem("fileId")&&N(localStorage.getItem("fileId")),localStorage.getItem("provider")&&De(localStorage.getItem("provider"))}),[]),!D||Me?Object(O.jsxs)(O.Fragment,{children:[Me?Object(O.jsx)(k.a,{variant:"danger",children:Me}):null,Object(O.jsx)("div",{style:{height:"100vh"},className:"d-flex align-items-center justify-content-center",children:Object(O.jsxs)("div",{style:{textAlign:"center"},children:[Object(O.jsx)(F,{openPicker:p,setFileSize:V,setFileId:N,setProvider:De}),Object(O.jsx)(A,{setFileSize:V,setFileId:N,setProvider:De,setLoadDropbox:_e}),Object(O.jsx)("br",{}),Object(O.jsx)("br",{}),Object(O.jsx)("p",{children:"Welcome to Buckets Viewer. Use one of the buttons above to select your .buckets file."})]})})]}):J&&K&&Q?Object(O.jsxs)("div",{children:[Object(O.jsx)(S.a,{bg:"dark",variant:"dark",children:Object(O.jsxs)(y.a,{children:[Object(O.jsxs)(S.a.Brand,{children:[Object(O.jsx)(E.a,{color:"white",style:{position:"relative",bottom:2}})," ","Buckets Viewer"]}),Object(O.jsxs)("div",{style:{textAlign:"right"},children:[Object(O.jsx)(m,{accessToken:ge,setAccessToken:xe,fileId:D,provider:Fe,setLoadDropbox:_e})," ",Object(O.jsxs)(x.a,{variant:"light",onClick:function(){N(null),R(null),xe(null),De(null)},children:[Object(O.jsx)(T.a,{})," Select New File"]})]})]})}),Object(O.jsxs)(y.a,{children:[Object(O.jsx)("br",{}),Object(O.jsx)("br",{}),Object(O.jsxs)(I.a,{activeKey:ie,onSelect:function(e){se(e),je(null)},children:[Object(O.jsx)(M.a,{eventKey:"buckets",title:"Buckets",children:de&&"bucket"!==!de[0]?Object(O.jsx)(w,{transactionView:de,setTransactionView:je,transactions:$,currency:Pe,dateFormat:Ve}):Object(O.jsx)(v,{buckets:J,bucketCats:K,setTransactionView:je,currency:Pe})}),Object(O.jsx)(M.a,{eventKey:"accounts",title:"Accounts",children:de&&"account"!==!de[0]?Object(O.jsx)(w,{transactionView:de,setTransactionView:je,transactions:ce,currency:Pe,dateFormat:Ve}):Object(O.jsx)(h,{accounts:Q,setTransactionView:je,currency:Pe})})]}),Object(O.jsxs)("div",{className:"footer",children:[fe?Object(O.jsxs)("p",{children:[Object(O.jsx)("br",{}),"Last loaded ",fe.toString()]}):null,Object(O.jsxs)("p",{children:["\xa92022 Dustin Lammiman."," ",Object(O.jsx)("a",{href:"privacy.html",children:"Privacy Policy"}),". This website is not associated with One Part Rain, LLC."]})]})]})]}):Object(O.jsx)("div",{style:{height:"100vh",textAlign:"center"},className:"d-flex align-items-center justify-content-center",children:Object(O.jsxs)("div",{children:[Object(O.jsxs)("p",{children:["Loading ",ke,"%"]}),Object(O.jsxs)("p",{children:["Progress bar stuck?"," ",Object(O.jsx)("button",{onClick:function(){localStorage.clear(),N(null)},className:"link",children:"Click here"})," ","to start over."]})]})})},_=n(179);Object(_.createRoot)(document.getElementById("root")).render(Object(O.jsx)(L,{}))}},[[313,1,2]]]);
//# sourceMappingURL=main.fc51f0e8.chunk.js.map