{"version":3,"sources":["components/Accounts.js","components/Buckets.js","components/Reload.js","App.js","index.js"],"names":["Accounts","accounts","currency","budgetAccounts","filter","a","offBudgetAccounts","Accordion","defaultActiveKey","alwaysOpen","Item","eventKey","Header","Body","Table","striped","hover","bordered","map","account","style","width","format","Buckets","buckets","bucketCats","Array","from","entries","cat","console","log","values","bucket","Reload","accessToken","setAccessToken","handleReload","src","Promise","resolve","reject","document","querySelector","script","createElement","onload","onerror","err","body","appendChild","then","window","google","oauth2","initTokenClient","client_id","process","scope","callback","tokenResponse","access_token","requestAccessToken","Button","variant","onClick","App","useState","db","setDb","useDrivePicker","openPicker","authResponse","fileId","setFileId","setBuckets","setBucketCats","setAccounts","view","setView","lastUpdated","setLastUpdated","reloadToken","setReloadToken","Intl","NumberFormat","handleOpenPicker","clientId","developerKey","viewId","showUploadView","showUploadFolders","supportDrives","multiselect","customScopes","viewMimeTypes","callbackFunction","data","action","docs","id","localStorage","setItem","useEffect","token","getFile","config","headers","Authorization","responseType","axios","get","response","uInt8Array","Uint8Array","initSqlJs","locateFile","file","SQL","Database","newBuckets","exec","reduce","entryMap","e","set","Map","JSON","stringify","newBucketCats","newAccounts","Date","getItem","parse","Navbar","bg","Container","Brand","color","position","bottom","textAlign","Tabs","activeKey","onSelect","k","Tab","title","toString","height","className","size","createRoot","getElementById","render"],"mappings":"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","file":"static/js/main.1de0d9fb.chunk.js","sourcesContent":["import { Accordion, Table } from \"react-bootstrap\"\n\nconst Accounts = ({ accounts, currency }) => {\n  const budgetAccounts = accounts.filter(a => a[3] === \"\")\n  const offBudgetAccounts = accounts.filter(a => a[3] === \"offbudget\")\n\n  return (\n    <Accordion defaultActiveKey={[0]} alwaysOpen>\n      <Accordion.Item eventKey={0}>\n        <Accordion.Header>Budget Accounts</Accordion.Header>\n        <Accordion.Body>\n          <Table striped hover bordered>\n            <tbody><tr><th>Name</th><th>Balance</th></tr>\n              {budgetAccounts.map(account => (\n                <tr key={account[0]}>\n                  <td>{account[1]}</td>\n                  <td style={{ width: \"30%\" }}>{currency.format(account[2]/100.0)}</td>\n                </tr>\n              ))}\n            </tbody>\n          </Table>\n        </Accordion.Body>\n      </Accordion.Item>\n      <Accordion.Item eventKey={1}>\n        <Accordion.Header>Off Budget Accounts</Accordion.Header>\n        <Accordion.Body>\n          <Table striped hover bordered>\n            <tbody><tr><th>Name</th><th>Balance</th></tr>\n              {offBudgetAccounts.map(account => (\n                <tr key={account[0]}>\n                  <td>{account[1]}</td>\n                  <td style={{ width: \"30%\" }}>{currency.format(account[2]/100.0)}</td>\n                </tr>\n              ))}\n            </tbody>\n          </Table>\n        </Accordion.Body>\n      </Accordion.Item>\n    </Accordion>\n  )\n}\n\nexport default Accounts","import { Accordion, Table } from \"react-bootstrap\"\n\nconst Buckets = ({ buckets, bucketCats, currency }) => {\n\n  return (\n    <Accordion defaultActiveKey={[]} alwaysOpen>\n      {Array.from(buckets.entries()).map((cat) => {\n        console.log(cat, bucketCats)\n        return (\n        <Accordion.Item eventKey={bucketCats.values[cat[0]-1][0]} key={bucketCats.values[cat[0]-1][0]}>\n          <Accordion.Header>{bucketCats.values[cat[0]-1][1]}</Accordion.Header>\n          <Accordion.Body>\n            <Table striped hover bordered>\n              <tbody><tr><th>Name</th><th>Balance</th></tr>\n              \n                {cat[1].map(bucket => (\n                  <tr key={bucket[0]}>\n                    <td>{bucket[1]}</td>\n                    <td style={{ width: \"30%\" }}>{currency.format(bucket[2]/100.0)}</td>\n                  </tr>\n                ))}\n              </tbody>\n            </Table>\n          </Accordion.Body>\n        </Accordion.Item>\n      )})}\n    </Accordion>\n  )\n}\n\nexport default Buckets","import { ArrowClockwise } from 'react-bootstrap-icons'\nimport { Button } from 'react-bootstrap'\n\nconst Reload = ({ accessToken, setAccessToken }) => {\n  \n  const loadScript = (src) =>\n    new Promise((resolve, reject) => {\n      if (document.querySelector(`script[src=\"${src}\"]`)) return resolve()\n      const script = document.createElement('script')\n      script.src = src\n      script.onload = () => resolve()\n      script.onerror = (err) => reject(err)\n      document.body.appendChild(script)\n  })\n\n  const handleReload = () => {\n    loadScript('https://accounts.google.com/gsi/client').then(() => {\n    const google = window.google  \n    const client = google.accounts.oauth2.initTokenClient({\n        client_id: process.env.REACT_APP_CLIENT_ID,\n        scope: 'https://www.googleapis.com/auth/drive.readonly',\n        callback: (tokenResponse) => {\n          setAccessToken(tokenResponse.access_token)\n        },\n      })\n\n      client.requestAccessToken();\n    })\n  }\n\n  return (\n    <Button variant=\"light\" onClick={() => handleReload()}><ArrowClockwise /> Reload</Button>\n  )\n}\n\nexport default Reload","import  { useEffect, useState } from 'react';\nimport useDrivePicker from 'react-google-drive-picker'\nimport axios from 'axios'\nimport initSqlJs from \"sql.js\"\nimport Accounts from './components/Accounts';\nimport Buckets from './components/Buckets';\nimport Reload from './components/Reload';\nimport { Container, Tab, Tabs, Navbar, Button } from 'react-bootstrap'\nimport { Bucket, FileEarmarkText } from 'react-bootstrap-icons'\n\nfunction App() {\n  const [db, setDb] = useState(null);\n  const [openPicker, authResponse] = useDrivePicker();  \n  const [fileId, setFileId] = useState(null)\n  const [buckets, setBuckets] = useState(null)\n  const [bucketCats, setBucketCats] = useState(null)\n  const [accounts, setAccounts] = useState(null)\n  const [view, setView] = useState(\"buckets\")\n  const [lastUpdated, setLastUpdated] = useState(null)\n  const [reloadToken, setReloadToken] = useState(null)\n\n  const currency = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' })\n\n  // Use Google Drive Picker\n  const handleOpenPicker = () => {\n    openPicker({\n      clientId: process.env.REACT_APP_CLIENT_ID,\n      developerKey: process.env.REACT_APP_DEVELOPER_KEY,\n      viewId: \"DOCS\",\n      // token: localStorage.getItem('auth') || null, // pass oauth token in case you already have one\n      showUploadView: true,\n      showUploadFolders: true,\n      supportDrives: true,\n      multiselect: true,\n      customScopes: ['https://www.googleapis.com/auth/drive.file'],\n      viewMimeTypes: \"application/octet-stream\",\n      // customViews: customViewsArray, // custom view\n      callbackFunction: (data) => {\n        if (data.action === 'cancel') {\n          console.log('User clicked cancel/close button')\n        }\n        if(data.action === 'picked') {\n          console.log(data)\n          setFileId(data.docs[0].id)\n          localStorage.setItem('fileId', data.docs[0].id);\n        }\n      },\n    })\n  }\n  \n  //If we have an auth token, load the DB from Google Drive\n  useEffect(()=>{\n    if((authResponse || reloadToken) && fileId) {\n      const token = authResponse ? authResponse.access_token : reloadToken\n      const getFile = async () => {\n        const config =  {\n          headers: { Authorization: `Bearer ${token}`,\n          'Content-Type': \"application/x-sqlite3\" },\n        responseType: 'arraybuffer'\n        }\n        const response = await axios.get(`https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`, config)\n        const uInt8Array = new Uint8Array(response.data)\n        const SQL = await initSqlJs({\n          locateFile: file => `https://sql.js.org/dist/${file}`\n        })\n        setDb(new SQL.Database(uInt8Array));\n      }\n      console.log(authResponse, fileId)\n      localStorage.setItem('fileId', fileId);\n      getFile()\n    }\n    console.log(fileId, authResponse || reloadToken)\n  }, [authResponse, reloadToken, fileId])\n\n  //DB Queries - Saved to Local Storage and State\n  useEffect(() => {\n    if(db) {\n      const newBuckets = db.exec(\"SELECT id, name, balance, group_id FROM bucket WHERE kicked = 0\")[0].values\n        .reduce(\n          (entryMap, e) => entryMap.set(e[3], [...entryMap.get(e[3])||[], e]),\n          new Map()\n      )\n      setBuckets(newBuckets)\n      localStorage.setItem(\"buckets\", JSON.stringify(Array.from(newBuckets)))\n      \n      const newBucketCats = db.exec(\"SELECT id, name FROM bucket_group\")[0]\n      setBucketCats(newBucketCats)\n      localStorage.setItem(\"bucketCats\", JSON.stringify(newBucketCats))\n      \n      const newAccounts = db.exec(\"SELECT id, name, balance, kind FROM account WHERE closed = 0\")[0].values\n      setAccounts(newAccounts)\n      localStorage.setItem(\"accounts\", JSON.stringify(newAccounts))\n\n      setLastUpdated(new Date())\n      localStorage.setItem('lastUpdated', JSON.stringify(new Date()))\n    }\n  }, [db])\n\n  //Retrieve Data from Local Storage\n  useEffect(() => {\n    if(localStorage.getItem('buckets')) {\n      setBuckets(new Map(JSON.parse(localStorage.getItem('buckets'))))\n    }\n    if(localStorage.getItem('bucketCats')) {\n      setBucketCats(JSON.parse(localStorage.getItem('bucketCats')))\n    }\n    if(localStorage.getItem('accounts')) {\n      setAccounts(JSON.parse(localStorage.getItem('accounts')))\n    }\n    if(localStorage.getItem('lastUpdated')) {\n      setLastUpdated(new Date(JSON.parse(localStorage.getItem('lastUpdated'))))\n    }\n    if(localStorage.getItem('fileId')) {\n      setFileId(localStorage.getItem('fileId'))\n    }\n  }, [])\n  \n  if(!buckets || !bucketCats || !accounts) {\n    return (\n      <div style={{ height: \"100vh\" }} className=\"d-flex align-items-center justify-content-center\">\n        <div style={{ textAlign: \"center\" }}>\n          <Button size=\"lg\" variant=\"primary\" onClick={() => handleOpenPicker()}>Select Budget</Button>\n          <br /><br />\n          <p>Welcome to Buckets Viewer. Use the button to select your .buckets file from Google Drive.</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <Navbar bg=\"dark\" variant=\"dark\">\n        <Container>\n          <Navbar.Brand><Bucket color=\"white\" style={{ position: \"relative\", bottom: 2 }} /> Buckets Viewer</Navbar.Brand>\n          <div style={{ textAlign: \"right\" }}>\n            <Reload accessToken={reloadToken} setAccessToken={setReloadToken} />{' '}\n            <Button variant=\"light\" onClick={() => handleOpenPicker()}><FileEarmarkText /> Select New File</Button>\n          </div>\n        </Container>\n      </Navbar>\n      <Container>\n        <br /><br />\n        <Tabs activeKey={view} onSelect={(k) => setView(k)}>\n          <Tab eventKey=\"buckets\" title=\"Buckets\">\n            <Buckets buckets={buckets} bucketCats={bucketCats} currency={currency} />\n          </Tab>\n          <Tab eventKey=\"accounts\" title=\"Accounts\">\n            <Accounts accounts={accounts} currency={currency} />\n          </Tab>\n        </Tabs>\n        { lastUpdated ? <p><br />Last updated { lastUpdated.toString() }</p> : null }\n      </Container>\n    </div>\n  )\n}\n\nexport default App;","import React from 'react'\nimport App from './App'\nimport { createRoot } from 'react-dom/client'\n\ncreateRoot(document.getElementById('root')).render(\n  <App />\n)\n"],"sourceRoot":""}