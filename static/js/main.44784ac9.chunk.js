(this["webpackJsonpbuckets-viewer"]=this["webpackJsonpbuckets-viewer"]||[]).push([[0],{175:function(e,t,c){var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,c=1,n=arguments.length;c<n;c++)for(var r in t=arguments[c])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},n.apply(this,arguments)},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=c(0),o=c(182),i=r(c(183));t.default=function(){var e,t=["https://www.googleapis.com/auth/drive.readonly"],c=(0,i.default)("https://apis.google.com/js/api.js"),r=c[0],s=c[1],l=(0,i.default)("https://accounts.google.com/gsi/client"),u=l[0],d=l[1],j=(0,a.useState)(!1),b=j[0],f=j[1],p=(0,a.useState)(!1),O=p[0],h=p[1],v=(0,a.useState)(o.defaultConfiguration),g=v[0],m=v[1],x=(0,a.useState)(),k=x[0],y=x[1],w=window.google;(0,a.useEffect)((function(){!r||s||!u||d||b||S()}),[r,s,u,d,b]),(0,a.useEffect)((function(){O&&g.token&&r&&!s&&u&&!d&&b&&(M(g),h(!1))}),[O,g.token,r,s,u,d,b]);var S=function(){window.gapi.load("auth"),window.gapi.load("picker",{callback:I})},I=function(){f(!0)},M=function(t){var c=t.token,n=t.supportDrives,r=void 0!==n&&n,a=t.developerKey,o=t.viewId,i=void 0===o?"DOCS":o,s=t.disabled,l=t.multiselect,u=t.showUploadView,d=void 0!==u&&u,j=t.showUploadFolders,b=t.setParentFolder,f=void 0===b?"":b,p=t.viewMimeTypes,O=t.viewQuery,h=t.customViews,v=t.locale,g=void 0===v?"en":v,m=t.setIncludeFolders,x=t.setSelectFolderEnabled,k=t.disableDefaultView,y=void 0!==k&&k,S=t.callbackFunction;if(s)return!1;var I=new w.picker.DocsView(w.picker.ViewId[i]);p&&I.setMimeTypes(p),m&&I.setSelectFolderEnabled(!0),x&&I.setSelectFolderEnabled(!0),O&&I.setQuery(O);var M=new w.picker.DocsUploadView;return p&&M.setMimeTypes(p),j&&M.setIncludeFolders(!0),f&&M.setParent(f),e=(new w.picker.PickerBuilder).setAppId("758483264841").setOAuthToken(c).setDeveloperKey(a).setLocale(g).setCallback(S),y||e.addView(I),h&&h.map((function(t){return e.addView(t)})),l&&e.enableFeature(w.picker.Feature.MULTISELECT_ENABLED),d&&e.addView(M),r&&e.enableFeature(w.picker.Feature.SUPPORT_DRIVES),e.build().setVisible(!0),!0};return[function(e){(m(e),e.token)||w.accounts.oauth2.initTokenClient({client_id:e.clientId,scope:(e.customScopes?e.customScopes:t).join(" "),callback:function(t){y(t),M(n(n({},e),{token:t.access_token}))}}).requestAccessToken();if(e.token&&r&&!s&&b)return M(e)},k]}},182:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultConfiguration=void 0,t.defaultConfiguration={clientId:"",developerKey:"",viewId:"DOCS",callbackFunction:function(){return null}}},183:function(e,t,c){Object.defineProperty(t,"__esModule",{value:!0});var n=c(0),r={queue:{},injectorMap:{},scriptMap:{}};t.default=function(e){var t=(0,n.useState)({loaded:!1,error:!1}),c=t[0],a=t[1];return(0,n.useEffect)((function(){var t,c,n,o,i;if((null===(t=r.injectorMap)||void 0===t?void 0:t[e])||(r.injectorMap[e]="init"),"loaded"!==r.injectorMap[e]){if("error"!==r.injectorMap[e]){var s=function(t){var c,n,a,o;t&&console.log("error loading the script"),null===(n=null===(c=r.queue)||void 0===c?void 0:c[e])||void 0===n||n.forEach((function(e){return e(t)})),t&&r.scriptMap[e]?(null===(o=null===(a=r.scriptMap)||void 0===a?void 0:a[e])||void 0===o||o.remove(),r.injectorMap[e]="error"):r.injectorMap[e]="loaded",delete r.scriptMap[e]},l=function(e){a({loaded:!0,error:e})};return(null===(c=r.scriptMap)||void 0===c?void 0:c[e])||(r.scriptMap[e]=document.createElement("script"),r.scriptMap[e]&&(r.scriptMap[e].src=e,r.scriptMap[e].async=!0,document.body.append(r.scriptMap[e]),r.scriptMap[e].addEventListener("load",(function(){return s(!1)})),r.scriptMap[e].addEventListener("error",(function(){return s(!0)})),r.injectorMap[e]="loading")),(null===(n=r.queue)||void 0===n?void 0:n[e])?null===(i=null===(o=r.queue)||void 0===o?void 0:o[e])||void 0===i||i.push(l):r.queue[e]=[l],function(){var t,c;r.scriptMap[e]&&(null===(t=r.scriptMap[e])||void 0===t||t.removeEventListener("load",(function(){return s(!0)})),null===(c=r.scriptMap[e])||void 0===c||c.removeEventListener("error",(function(){return s(!0)})))}}a({loaded:!0,error:!0})}else a({loaded:!0,error:!1})}),[e]),[c.loaded,c.error]}},208:function(e,t){},210:function(e,t){},221:function(e,t){},223:function(e,t){},249:function(e,t){},251:function(e,t){},252:function(e,t){},257:function(e,t){},259:function(e,t){},265:function(e,t){},267:function(e,t){},286:function(e,t){},298:function(e,t){},301:function(e,t){},310:function(e,t,c){},313:function(e,t,c){"use strict";c.r(t);var n=c(0),r=c(49),a=c(109),o=c(174),i=c(7),s=c(175),l=c.n(s),u=c(176),d=c.n(u),j=c(177),b=c.n(j),f=c(325),p=c(316),O=c(1),h=function(e){var t=e.accounts,c=e.setTransactionView,n=e.currency,r=t.filter((function(e){return"offbudget"!==e[3]})),a=t.filter((function(e){return"offbudget"===e[3]}));return Object(O.jsxs)(f.a,{defaultActiveKey:[0],alwaysOpen:!0,children:[Object(O.jsxs)(f.a.Item,{eventKey:0,children:[Object(O.jsx)(f.a.Header,{children:"Budget Accounts"}),Object(O.jsx)(f.a.Body,{children:Object(O.jsx)(p.a,{striped:!0,hover:!0,bordered:!0,children:Object(O.jsxs)("tbody",{children:[Object(O.jsxs)("tr",{children:[Object(O.jsx)("th",{children:"Name"}),Object(O.jsx)("th",{children:"Balance"})]}),r.map((function(e){return Object(O.jsxs)("tr",{onClick:function(){c(["account",e[0],e[1],e[2]])},children:[Object(O.jsx)("td",{children:e[1]}),Object(O.jsx)("td",{children:n.format(e[2]/100)})]},e[0])}))]})})})]}),Object(O.jsxs)(f.a.Item,{eventKey:1,children:[Object(O.jsx)(f.a.Header,{children:"Off Budget Accounts"}),Object(O.jsx)(f.a.Body,{children:Object(O.jsx)(p.a,{striped:!0,hover:!0,bordered:!0,children:Object(O.jsxs)("tbody",{children:[Object(O.jsxs)("tr",{children:[Object(O.jsx)("th",{children:"Name"}),Object(O.jsx)("th",{children:"Balance"})]}),a.map((function(e){return Object(O.jsxs)("tr",{onClick:function(){c(["account",e[0],e[1],e[2]])},children:[Object(O.jsx)("td",{children:e[1]}),Object(O.jsx)("td",{children:n.format(e[2]/100)})]},e[0])}))]})})})]})]})},v=function(e){var t=e.buckets,c=e.bucketCats,n=e.setTransactionView,r=e.currency;return Object(O.jsx)(f.a,{defaultActiveKey:[],alwaysOpen:!0,children:Array.from(t.entries()).map((function(e,t){return Object(O.jsxs)(f.a.Item,{eventKey:t,children:[Object(O.jsx)(f.a.Header,{children:c.values[e[0]-1]?c.values[e[0]-1][1]:"Misc"}),Object(O.jsx)(f.a.Body,{children:Object(O.jsx)(p.a,{striped:!0,hover:!0,bordered:!0,children:Object(O.jsxs)("tbody",{children:[Object(O.jsxs)("tr",{children:[Object(O.jsx)("th",{children:"Name"}),Object(O.jsx)("th",{children:"Balance"})]}),e[1].map((function(e){return Object(O.jsxs)("tr",{children:[Object(O.jsx)("td",{onClick:function(){n(["bucket",e[0],e[1],e[2]])},children:e[1]}),Object(O.jsx)("td",{children:r.format(e[2]/100)})]},e[0])}))]})})})]},t)}))})},g=c(318),m=c(317),x=function(e){e.accessToken;var t=e.setAccessToken,c=function(){var e;(e="https://accounts.google.com/gsi/client",new Promise((function(t,c){if(document.querySelector('script[src="'.concat(e,'"]')))return t();var n=document.createElement("script");n.src=e,n.onload=function(){return t()},n.onerror=function(e){return c(e)},document.body.appendChild(n)}))).then((function(){window.google.accounts.oauth2.initTokenClient({client_id:"758483264841-9kmp9h0v8qghfn8e7d4k5mjg99d0fpn8.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/drive.file",callback:function(e){t(e.access_token)}}).requestAccessToken()}))};return Object(O.jsxs)(m.a,{variant:"light",onClick:function(){return c()},children:[Object(O.jsx)(g.a,{})," Reload"]})},k=function(e){var t=e.transactionView,c=e.setTransactionView,n=e.transactions,r=e.currency,a=e.dateFormat;if(!n)return Object(O.jsx)("p",{children:"No transactions found. You probably need to reload your budget file to see transactions."});var o=n.filter((function(e){return e[1]===t[1]})).reverse();return Object(O.jsxs)("div",{children:[Object(O.jsx)("h3",{children:t[2]}),Object(O.jsxs)("p",{children:[Object(O.jsxs)("strong",{children:["Balance: ",r.format(t[3]/100)]})," ","|"," ",Object(O.jsx)("button",{className:"back",onClick:function(){c(null)},children:"Go Back"})]}),Object(O.jsx)(p.a,{striped:!0,hover:!0,bordered:!0,children:Object(O.jsxs)("tbody",{children:[Object(O.jsxs)("tr",{children:[Object(O.jsx)("th",{children:"Posted"}),Object(O.jsx)("th",{children:"Memo"}),Object(O.jsx)("th",{children:"Amount"})]}),o.map((function(e){return Object(O.jsxs)("tr",{children:[Object(O.jsx)("td",{children:new Date(e[2].split(" ")[0]).toLocaleDateString(void 0,a)}),Object(O.jsx)("td",{children:e[3]}),Object(O.jsx)("td",{children:r.format(e[4]/100)})]},e[0])}))]})})]})},y=c(319),w=c(323),S=c(320),I=c(324),M=c(326),E=c(321),T=c(322);c(310);var C=function(){var e=Object(n.useState)(null),t=Object(i.a)(e,2),c=t[0],s=t[1],u=l()(),j=Object(i.a)(u,2),f=j[0],p=j[1],g=Object(n.useState)(null),C=Object(i.a)(g,2),F=C[0],_=C[1],N=Object(n.useState)(null),V=Object(i.a)(N,2),A=V[0],D=V[1],B=Object(n.useState)(null),L=Object(i.a)(B,2),J=L[0],P=L[1],q=Object(n.useState)(null),R=Object(i.a)(q,2),U=R[0],K=R[1],H=Object(n.useState)(null),z=Object(i.a)(H,2),W=z[0],Q=z[1],G=Object(n.useState)(null),Y=Object(i.a)(G,2),X=Y[0],Z=Y[1],$=Object(n.useState)(null),ee=Object(i.a)($,2),te=ee[0],ce=ee[1],ne=Object(n.useState)("buckets"),re=Object(i.a)(ne,2),ae=re[0],oe=re[1],ie=Object(n.useState)(null),se=Object(i.a)(ie,2),le=se[0],ue=se[1],de=Object(n.useState)(null),je=Object(i.a)(de,2),be=je[0],fe=je[1],pe=Object(n.useState)(null),Oe=Object(i.a)(pe,2),he=Oe[0],ve=Oe[1],ge=Object(n.useState)(0),me=Object(i.a)(ge,2),xe=me[0],ke=me[1],ye=Object(n.useState)(null),we=Object(i.a)(ye,2),Se=we[0],Ie=we[1],Me=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),Ee={year:"numeric",month:"long",day:"numeric"},Te=function(){f({clientId:"758483264841-9kmp9h0v8qghfn8e7d4k5mjg99d0fpn8.apps.googleusercontent.com",developerKey:"AIzaSyAmKw4RxJhq67-H-M2HkjoqibzJN5fzqds",viewId:"DOCS",showUploadView:!1,showUploadFolders:!1,supportDrives:!0,multiselect:!0,viewMimeTypes:"application/octet-stream",viewQuery:"*.buckets",customScopes:["https://www.googleapis.com/auth/drive.file"],callbackFunction:function(e){"cancel"===e.action&&console.log("User clicked cancel/close button"),"picked"===e.action&&(D(e.docs[0].sizeBytes),_(e.docs[0].id),localStorage.setItem("fileId",e.docs[0].id))}})};return Object(n.useEffect)((function(){if((p||he)&&F){Ie(null);var e=p?p.access_token:he,t=function(){var t=Object(o.a)(Object(a.a)().mark((function t(){var c,n,r,o;return Object(a.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c={headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/x-sqlite3"},responseType:"arraybuffer",onDownloadProgress:function(e){ke(Math.floor(e.loaded/A*100))}},t.next=3,d.a.get("https://www.googleapis.com/drive/v3/files/".concat(F,"?alt=media&supportsAllDrives=true"),c).catch((function(e){Ie(e.message),_(null),P(null),localStorage.clear()}));case 3:return n=t.sent,r=new Uint8Array(n.data),t.next=7,b()({locateFile:function(e){return"https://sql.js.org/dist/".concat(e)}});case 7:o=t.sent,s(new o.Database(r));case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();localStorage.setItem("fileId",F),t()}}),[p,he,F,A]),Object(n.useEffect)((function(){if(c)try{var e=c.exec("SELECT id, name, balance, group_id FROM bucket WHERE kicked = 0")[0].values.reduce((function(e,t){return e.set(t[3],[].concat(Object(r.a)(e.get(t[3])||[]),[t]))}),new Map);P(e),localStorage.setItem("buckets",JSON.stringify(Array.from(e)));var t=c.exec("SELECT id, name FROM bucket_group")[0];K(t),localStorage.setItem("bucketCats",JSON.stringify(t));var n=c.exec("SELECT id, name, balance, kind FROM account WHERE closed = 0")[0].values;Q(n),localStorage.setItem("accounts",JSON.stringify(n));var a=c.exec('SELECT id, bucket_id, posted, memo, amount FROM bucket_transaction WHERE posted > date("now","-1 years")')[0].values;Z(a),localStorage.setItem("bucketTransactions",JSON.stringify(a));var o=c.exec('SELECT id, account_id, posted, memo, amount FROM account_transaction WHERE posted > date("now","-1 years")')[0].values;ce(o),localStorage.setItem("accountTransactions",JSON.stringify(o)),fe(new Date),localStorage.setItem("lastUpdated",JSON.stringify(new Date))}catch(i){Ie(i.toString()),_(null),P(null),s(null),localStorage.clear()}}),[c]),Object(n.useEffect)((function(){localStorage.getItem("buckets")&&P(new Map(JSON.parse(localStorage.getItem("buckets")))),localStorage.getItem("bucketCats")&&K(JSON.parse(localStorage.getItem("bucketCats"))),localStorage.getItem("accounts")&&Q(JSON.parse(localStorage.getItem("accounts"))),localStorage.getItem("bucketTransactions")&&Z(JSON.parse(localStorage.getItem("bucketTransactions"))),localStorage.getItem("accountTransactions")&&ce(JSON.parse(localStorage.getItem("accountTransactions"))),localStorage.getItem("lastUpdated")&&fe(new Date(JSON.parse(localStorage.getItem("lastUpdated")))),localStorage.getItem("fileId")&&_(localStorage.getItem("fileId"))}),[]),!F||Se?Object(O.jsxs)(O.Fragment,{children:[Se?Object(O.jsx)(y.a,{variant:"danger",children:Se}):null,Object(O.jsx)("div",{style:{height:"100vh"},className:"d-flex align-items-center justify-content-center",children:Object(O.jsxs)("div",{style:{textAlign:"center"},children:[Object(O.jsx)(m.a,{size:"lg",variant:"primary",onClick:function(){return Te()},children:"Select Budget"}),Object(O.jsx)("br",{}),Object(O.jsx)("br",{}),Object(O.jsx)("p",{children:"Welcome to Buckets Viewer. Use the button to select your .buckets file from Google Drive."})]})})]}):J&&U&&W?Object(O.jsxs)("div",{children:[Object(O.jsx)(w.a,{bg:"dark",variant:"dark",children:Object(O.jsxs)(S.a,{children:[Object(O.jsxs)(w.a.Brand,{children:[Object(O.jsx)(E.a,{color:"white",style:{position:"relative",bottom:2}})," ","Buckets Viewer"]}),Object(O.jsxs)("div",{style:{textAlign:"right"},children:[Object(O.jsx)(x,{accessToken:he,setAccessToken:ve})," ",Object(O.jsxs)(m.a,{variant:"light",onClick:function(){return Te()},children:[Object(O.jsx)(T.a,{})," Select New File"]})]})]})}),Object(O.jsxs)(S.a,{children:[Object(O.jsx)("br",{}),Object(O.jsx)("br",{}),Object(O.jsxs)(I.a,{activeKey:ae,onSelect:function(e){oe(e),ue(null)},children:[Object(O.jsx)(M.a,{eventKey:"buckets",title:"Buckets",children:le&&"bucket"!==!le[0]?Object(O.jsx)(k,{transactionView:le,setTransactionView:ue,transactions:X,currency:Me,dateFormat:Ee}):Object(O.jsx)(v,{buckets:J,bucketCats:U,setTransactionView:ue,currency:Me})}),Object(O.jsx)(M.a,{eventKey:"accounts",title:"Accounts",children:le&&"account"!==!le[0]?Object(O.jsx)(k,{transactionView:le,setTransactionView:ue,transactions:te,currency:Me,dateFormat:Ee}):Object(O.jsx)(h,{accounts:W,setTransactionView:ue,currency:Me})})]}),Object(O.jsxs)("div",{className:"footer",children:[be?Object(O.jsxs)("p",{children:[Object(O.jsx)("br",{}),"Last loaded ",be.toString()]}):null,Object(O.jsxs)("p",{children:["\xa92022 Dustin Lammiman."," ",Object(O.jsx)("a",{href:"privacy.html",children:"Privacy Policy"}),". This website is not associated with One Part Rain, LLC."]})]})]})]}):Object(O.jsx)("div",{style:{height:"100vh",textAlign:"center"},className:"d-flex align-items-center justify-content-center",children:Object(O.jsxs)("div",{children:[Object(O.jsxs)("p",{children:["Loading ",xe,"%"]}),Object(O.jsxs)("p",{children:["Progress bar stuck?"," ",Object(O.jsx)("button",{onClick:function(){localStorage.clear(),_(null)},class:"link",children:"Click here"})," ","to start over."]})]})})},F=c(178);Object(F.createRoot)(document.getElementById("root")).render(Object(O.jsx)(C,{}))}},[[313,1,2]]]);
//# sourceMappingURL=main.44784ac9.chunk.js.map